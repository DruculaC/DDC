C51 COMPILER V9.51   VOICE                                                                 12/05/2013 14:04:14 PAGE 1   


C51 COMPILER V9.51, COMPILATION OF MODULE VOICE
OBJECT MODULE PLACED IN voice.OBJ
COMPILER INVOKED BY: D:\Program Files (x86)\keil\C51\BIN\C51.EXE voice.c BROWSE DEBUG OBJECTEXTEND TABS(3)

line level    source

   1          /*---------------------------------------------------
   2             voice.c (v1.00)
   3             
   4             语音提示子程序
   5          ---------------------------------------------------*/
   6          
   7          #include "main.h"
   8          #include "port.h"
   9          
  10          #include "voice.h"
  11          #include "Delay.h"
  12          #include "communication.h"
  13          
  14          /*------ private variable --------------------------*/
  15          tByte key_rotate_on_speech_number = 1;
  16             
  17          /*--------------------------------------------------
  18             SC_Speech()
  19             
  20             调用语音芯片，播报语音提示，几次脉冲表示播放第
  21             几段语音提示
  22          ---------------------------------------------------*/
  23          
  24          void SC_Speech(tByte cnt)
  25          {
  26   1         tByte i;
  27   1         SC_RST=0;
  28   1         delay_ms(40);
  29   1         SC_RST=1;
  30   1         delay_ms(40);
  31   1         for(i=0;i < cnt;i++)
  32   1         {
  33   2            SC_DATA=1; // 数据脉冲高
  34   2            delay_us(250);
  35   2            SC_DATA=0; // 数据脉冲低
  36   2            delay_us(250);
  37   2         }
  38   1      }
  39          
  40          /*--------------------------------------------------
  41             SC_Speech2()
  42             
  43             调用语音芯片，播报语音提示，几次脉冲表示播放第
  44             几段语音提示
  45          ---------------------------------------------------*/
  46          
  47          void SC_Speech2(tByte cnt)
  48          {
  49   1         tByte i;
  50   1         SC_RST=0;
  51   1         delay_ms(40);
  52   1         SC_RST=1;
  53   1         delay_ms(40);
  54   1         for(i=0;i < cnt;i++)
  55   1         {
C51 COMPILER V9.51   VOICE                                                                 12/05/2013 14:04:14 PAGE 2   

  56   2            SC_DATA=1; // 数据脉冲高
  57   2            delay_us(250);
  58   2            SC_DATA=0; // 数据脉冲低
  59   2            delay_us(250);
  60   2         }
  61   1      }
  62          
  63          /*-------------------------------------------------
  64             noVoice()
  65             
  66             在上电的时候调用，屏蔽语音的误报
  67          --------------------------------------------------*/
  68          
  69          void noVoice()
  70          {
  71   1         P14=0;
  72   1         SC_DATA=0;
  73   1         SC_RST=0;
  74   1         delay_us(100); // 上电复位防止干扰发声
  75   1         SC_RST=1;
  76   1         delay_us(100);
  77   1         P14=1;
  78   1      }
  79          
  80          /*----------------------------------------------------
  81             key_rotate_on_speech()
  82             钥匙转动到on的时候，语音提示
  83          -----------------------------------------------------*/
  84          void key_rotate_on_speech(void)
  85             {
  86   1         switch(key_rotate_on_speech_number)
  87   1            {
  88   2            case 1:
  89   2               {
  90   3               voice_EN=1;
  91   3               SC_Speech(10);  
  92   3               Delay(20);
  93   3               SC_Speech(11);  
  94   3               Delay(20);
  95   3               SC_Speech(6);  
  96   3               Delay(80);
  97   3               voice_EN=0;
  98   3               key_rotate_on_speech_number = 2;
  99   3               }
 100   2            break;
 101   2            
 102   2            case 2:
 103   2               {
 104   3               voice_EN=1;
 105   3               SC_Speech(10);  
 106   3               Delay(20);
 107   3               SC_Speech(8);  
 108   3               Delay(60);
 109   3               voice_EN=0;
 110   3               key_rotate_on_speech_number = 3;       
 111   3               }
 112   2            break;
 113   2            
 114   2            case 3:
 115   2               {
 116   3               voice_EN=1;
 117   3               SC_Speech(10);  
C51 COMPILER V9.51   VOICE                                                                 12/05/2013 14:04:14 PAGE 3   

 118   3               Delay(20);
 119   3               SC_Speech(11);  
 120   3               Delay(20);
 121   3               SC_Speech(7);  
 122   3               Delay(60);
 123   3               voice_EN=0;
 124   3               key_rotate_on_speech_number = 1;       
 125   3               }
 126   2            break;
 127   2            }
 128   1         }
 129             
 130          /*-----------------------------------------------------
 131             key_rotate_off_speech()
 132             钥匙转动到off的时候，语音提示
 133          ------------------------------------------------------*/
 134          void key_rotate_off_speech(void)
 135             {
 136   1         voice_EN=1;
 137   1         SC_Speech(9);
 138   1         Delay(60);
 139   1         voice_EN=0;
 140   1         }
 141          
 142          /*----------------------------------------------------
 143             motorBAT_low_speech()
 144             电瓶电量低于最小限定值，语音提示。
 145          -----------------------------------------------------*/
 146          void motorBAT_low_speech(void)
 147             {
 148   1         voice_EN=1;
 149   1         SC_Speech(5);
 150   1         Delay(60);
 151   1         voice_EN=0;
 152   1         }
 153          
 154          /*----------------------------------------------------
 155             host_touch_speech()
 156             第一次碰主机，会有一句提示语音
 157          --------------------------------------------------------*/
 158          void host_touch_speech(void)
 159             {
 160   1         voice_EN=1;
 161   1         SC_Speech2(2);  
 162   1         Delay(60);
 163   1         voice_EN=0;
 164   1         }
 165          
 166          /*-----------------------------------------------------
 167             host_2ndtouch_speech()
 168             第二次触碰主机，再报一个提示语音
 169          -------------------------------------------------------*/
 170          void host_2ndtouch_speech(void)
 171             {
 172   1         voice_EN=1;
 173   1         SC_Speech2(14);  
 174   1         Delay(150);
 175   1         voice_EN=0;
 176   1         }
 177             
 178          /*----------------------------------------------------
 179             stolen_alarm_speech()
C51 COMPILER V9.51   VOICE                                                                 12/05/2013 14:04:14 PAGE 4   

 180             判断为被盗的时候，发出报警语音第一段
 181          ----------------------------------------------------*/
 182          void stolen_alarm_speech1(void)
 183             {
 184   1         voice_EN=1;
 185   1         SC_Speech(15); 
 186   1         ComMode_3_Data();
 187   1         Delay(120);
 188   1         SC_Speech(13); 
 189   1         ComMode_3_Data();
 190   1         Delay(60);
 191   1         voice_EN=0; 
 192   1         }
 193          
 194          /*----------------------------------------------------
 195             stolen_alarm_speech()
 196             判断为被盗的时候，发出报警语音第二段
 197          ----------------------------------------------------*/
 198          void stolen_alarm_speech2(void)
 199             {
 200   1         voice_EN=1;
 201   1         SC_Speech(3); 
 202   1         ComMode_3_Data();
 203   1         Delay(120);
 204   1         SC_Speech(13); 
 205   1         ComMode_3_Data();
 206   1         Delay(60);
 207   1         voice_EN=0; 
 208   1         }
 209          
 210          /*----------------------------------------------------
 211             slave_nearby_speech()
 212             主机接到附机信号后，表明主机知道附机在附近，此时
 213             报一段语音。
 214          -----------------------------------------------------*/
 215          void slave_nearby_speech(void)
 216             {
 217   1         voice_EN=1;
 218   1         SC_Speech(16); 
 219   1         Delay(50);
 220   1         voice_EN=0;
 221   1         }
 222          
 223          /*----------------------------------------------------
 224             slave_away_speech()
 225             主机接不到附机信号后，表明主机认为附机离开了，此时
 226             报一段语音
 227          -----------------------------------------------------*/
 228          void slave_away_speech(void)
 229             {
 230   1         voice_EN=1;
 231   1         SC_Speech(17);  
 232   1         Delay(50);
 233   1         SC_Speech(4);  
 234   1         Delay(60);
 235   1         voice_EN=0;
 236   1         }
 237          
 238          /*---------------------------------------------------
 239             end of file
 240          ----------------------------------------------------*/

C51 COMPILER V9.51   VOICE                                                                 12/05/2013 14:04:14 PAGE 5   


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    440    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      1       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
