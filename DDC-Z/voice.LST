C51 COMPILER V9.51   VOICE                                                                 11/04/2013 10:31:59 PAGE 1   


C51 COMPILER V9.51, COMPILATION OF MODULE VOICE
OBJECT MODULE PLACED IN voice.OBJ
COMPILER INVOKED BY: D:\Program Files (x86)\keil\C51\BIN\C51.EXE voice.c BROWSE DEBUG OBJECTEXTEND TABS(3)

line level    source

   1          /*---------------------------------------------------
   2             voice.c (v1.00)
   3             
   4             语音提示子程序
   5          ---------------------------------------------------*/
   6          
   7          #include "main.h"
   8          #include "port.h"
   9          
  10          #include "voice.h"
  11          #include "Delay.h"
  12          #include "communication.h"
  13             
  14          /*--------------------------------------------------
  15             SC_Speech()
  16             
  17             调用语音芯片，播报语音提示，几次脉冲表示播放第
  18             几段语音提示
  19          ---------------------------------------------------*/
  20          
  21          void SC_Speech(unsigned char cnt)
  22          {
  23   1         unsigned char i;
  24   1      // SC_RST=1;
  25   1      // delay_ms(15); //DAC, 大于 32 段为 15MS
  26   1         SC_RST=0;
  27   1         delay_ms(40);
  28   1         SC_RST=1;
  29   1         delay_ms(40);
  30   1         for(i=0;i < cnt;i++)
  31   1         {
  32   2            SC_DATA=1; // 数据脉冲高
  33   2      //    delay_us(350); // 延时 100US
  34   2            delay_us(30);
  35   2            SC_DATA=0; // 数据脉冲低
  36   2      //    delay_us(350); // 延时 100US
  37   2            delay_us(30);
  38   2         }
  39   1      }
  40          
  41          /*--------------------------------------------------
  42             SC_Speech2()
  43             
  44             调用语音芯片，播报语音提示，几次脉冲表示播放第
  45             几段语音提示
  46          ---------------------------------------------------*/
  47          
  48          void SC_Speech2(unsigned char cnt)
  49          {
  50   1         unsigned char i;
  51   1      // SC_RST=1;
  52   1      // delay_ms(15); //DAC, 大于 32 段为 15MS
  53   1         SC_RST=0;
  54   1         delay_ms(40);
  55   1         SC_RST=1;
C51 COMPILER V9.51   VOICE                                                                 11/04/2013 10:31:59 PAGE 2   

  56   1         delay_ms(40);
  57   1         for(i=0;i < cnt;i++)
  58   1         {
  59   2            SC_DATA=1; // 数据脉冲高
  60   2      //    delay_us(350); // 延时 100US
  61   2            delay_us(30);
  62   2            SC_DATA=0; // 数据脉冲低
  63   2      //    delay_us(350); // 延时 100US
  64   2            delay_us(30);
  65   2         }
  66   1      }
  67          
  68          /*-------------------------------------------------
  69             noVoice()
  70             
  71             在上电的时候调用，屏蔽语音的误报
  72          --------------------------------------------------*/
  73          
  74          void noVoice()
  75          {
  76   1         P14=0;
  77   1         SC_DATA=0;
  78   1         SC_RST=0;
  79   1         delay_us(100); // 上电复位防止干扰发声
  80   1         SC_RST=1;
  81   1         delay_us(100);
  82   1         P14=1;
  83   1      }
  84          
  85          /*----------------------------------------------------
  86             key_rotate_on_speech()
  87             钥匙转动到on的时候，语音提示
  88          -----------------------------------------------------*/
  89          void key_rotate_on_speech(void)
  90             {
  91   1         voice_EN=1;
  92   1         SC_Speech(7);  
  93   1         Delay(160);
  94   1         voice_EN=0;
  95   1         }
  96             
  97          /*-----------------------------------------------------
  98             key_rotate_off_speech()
  99             钥匙转动到off的时候，语音提示
 100          ------------------------------------------------------*/
 101          void key_rotate_off_speech(void)
 102             {
 103   1         voice_EN=1;
 104   1         SC_Speech(9);
 105   1         Delay(130);
 106   1         voice_EN=0;
 107   1         }
 108          
 109          /*----------------------------------------------------
 110             motorBAT_low_speech()
 111             电瓶电量低于最小限定值，语音提示。
 112          -----------------------------------------------------*/
 113          void motorBAT_low_speech(void)
 114             {
 115   1         voice_EN=1;
 116   1         SC_Speech(10);
 117   1         Delay(100);
C51 COMPILER V9.51   VOICE                                                                 11/04/2013 10:31:59 PAGE 3   

 118   1         voice_EN=0;
 119   1         }
 120             
 121          /*----------------------------------------------------
 122             stolen_alarm_speech()
 123             判断为被盗的时候，发出报警语音
 124          ----------------------------------------------------*/
 125          void stolen_alarm_speech(void)
 126             {
 127   1         voice_EN=1;
 128   1         SC_Speech(22); 
 129   1         ComMode_3_Data();
 130   1         Delay(100);
 131   1         SC_Speech(23); 
 132   1         ComMode_3_Data();
 133   1         Delay(60);
 134   1         voice_EN=0; 
 135   1         }
 136          
 137          /*----------------------------------------------------
 138             slave_nearby_speech()
 139             主机接到附机信号后，表明主机知道附机在附近，此时
 140             报一段语音。
 141          -----------------------------------------------------*/
 142          void slave_nearby_speech(void)
 143             {
 144   1         voice_EN=1;
 145   1         SC_Speech(11); 
 146   1         Delay(150);
 147   1         voice_EN=0;
 148   1         }
 149          
 150          /*----------------------------------------------------
 151             slave_away_speech()
 152             主机接不到附机信号后，表明主机认为附机离开了，此时
 153             报一段语音
 154          -----------------------------------------------------*/
 155          void slave_away_speech(void)
 156             {
 157   1         voice_EN=1;
 158   1         SC_Speech(12);  
 159   1         Delay(80);
 160   1         SC_Speech(13);
 161   1         Delay(80);
 162   1         voice_EN=0;
 163   1         }
 164          
 165          /*----------------------------------------------------
 166             host_touch_speech()
 167             第一次碰主机，会有一句提示语音
 168          --------------------------------------------------------*/
 169          void host_touch_speech(void)
 170             {
 171   1         voice_EN=1;
 172   1         SC_Speech2(17);  //关机语言提醒
 173   1         Delay(80);
 174   1         voice_EN=0;
 175   1         }
 176          /*---------------------------------------------------
 177             end of file
 178          ----------------------------------------------------*/

C51 COMPILER V9.51   VOICE                                                                 11/04/2013 10:31:59 PAGE 4   


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    280    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
