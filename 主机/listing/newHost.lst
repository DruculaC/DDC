C51 COMPILER V9.01   NEWHOST                                                               08/18/2013 12:09:10 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE NEWHOST
OBJECT MODULE PLACED IN .\out\newHost.obj
COMPILER INVOKED BY: D:\Program Files (x86)\keil\C51\BIN\C51.EXE newHost.c LARGE BROWSE DEBUG OBJECTEXTEND PRINT(.\listi
                    -ng\newHost.lst) OBJECT(.\out\newHost.obj)

line level    source

   1          //µç¶¯³µ
   2          #include"N79E81x.h"
   3          #include<intrins.h>
   4          #include"AD.h"
   5          #include"UART.h"
   6          #include"T0.h"
   7          #include"voice.h"
   8          #include"pwm.h"
   9          #include"T1.h"
  10          
  11          //¶¨ÒåÍ¨ĞÅÃüÁî
  12          #define CmdStart 0x00 //¿ª»úÃüÁî
  13          #define CmdStop 0x01  //¹Ø»úÃüÁî
  14          #define ComMode_1 0xc1 //Í¨ĞÅÄ£Ê½1 
  15          #define ComMode_2 0xc2 //Í¨ĞÅÄ£Ê½2
  16          #define ComMode_3 0xc3 //Í¨ĞÅÄ£Ê½3
  17          #define ComMode_4 0xc4 //Ì§ÆğÖ¸Áî
  18          #define ComMode_5 0xc5//µ¹µØÖ¸Áî
  19          #define ComMode_6 0xc6  //³äµçÒÑÂúÖ¸Áî
  20          #define Succeed 0xce  //Í¨ĞÅ³É¹¦
  21          #define Wrong 0xff    //Í¨ĞÅÊ§°Ü
  22          #define CmdHead 0xc8
  23          #define CmdHead1 0x33 //Êı¾İÖ¡µÄÊ×²¿1, 00110011,11
  24          #define CmdHead2 0xcc //Êı¾İÖ¡µÄÊ×²¿2,11001100,00
  25          #define CmdHead3 0x3c //Êı¾İÖ¡µÄÊ×²¿3,11000011,01
  26          #define CmdHead4 0xcc //Êı¾İÖ¡µÄÊ×²¿4,11001100,00
  27          #define MyAddress 0xe0
  28          #define MyAddress1 0x33 //±¾»úµØÖ·1, 00110011,11
  29          #define MyAddress2 0x3c //±¾»úµØÖ·2, 11000011,01
  30          #define MyAddress3 0xcc //±¾»úµØÖ·3,11001100,00
  31          #define MyAddress4 0xcc //±¾»úµØÖ·4,11001100,00
  32          
  33          //ÉèÖÃ±¨µçÁ¿µÄ°´Å¥£¬1µÄÊ±ºò±¨Ò»ÏÂµçÁ¿£¬0µÄÊ±ºòÎª³£Ì¬
  34          sbit det_battery=P2^4;                  
  35          
  36          //ÉèÖÃ³äµçÖ¸Ê¾
  37          sbit det_charge=P0^2;
  38          //Ö÷»úµÄ·¢Éä²¿·ÖµÄ¿ØÖÆ¶Ë¿Ú
  39          //sbit PWMout=P0^1;//·¢Éä»úµÄ·½²¨Êä³ö¿Ú£¬Ê¹ÓÃÍâÉèPWM
  40          sbit ModeControl_1=P2^6;//·¢Éä»úÄ£Ê½¿ØÖÆ,0ÁÁÎª30MÄ£Ê½£¬1ÃğÎª300MÄ£Ê½
  41          sbit tran_en=P2^7;//·¢Éä»ú¿ª¹Ø£¬1ÁÁÎª¿ªÁË£¬0ÃğÎª¹ØÁË
  42          
  43          //ÈıÖá´«¸ĞÆ÷
  44          sbit ReceWave=P0^7;//ÈıÖá´«¸ĞÆ÷ÊäÈë¶Ë
  45          sbit SensorControl=P2^5;//ÈıÖá´«¸ĞÆ÷¿ØÖÆ¶Ë
  46          
  47          //µç´ÅÌú,  Æ½Ê±ÖµÎª00£¬¿ªËøÓÃ10£¬¹ØËøÓĞ01£¬È»ºó¶¼»Ö¸´µ½00
  48          sbit MagentControl_1=P2^2;
  49          sbit MagentControl_2=P2^3;
  50          
  51          //Ê°ÒôÆ÷¿ØÖÆ ADµÄ6ºÅÍ¨µÀÎªÊ°ÒôÆ÷µÄÒôÁ¿¼ì²é¶Ë
  52          //sbit VoiceControl=P2^4;//Ê°ÒôÆ÷¿ØÖÆ¶Ë
  53          
  54          sbit upSignal=P0^4;//Ì§ÆğĞÅºÅ
C51 COMPILER V9.01   NEWHOST                                                               08/18/2013 12:09:10 PAGE 2   

  55          sbit downSignal=P0^3;//µ¹µØĞÅºÅ
  56          
  57          //µç³Ø¿ØÖÆ      ADµÄ1ºÅÍ¨µÀÎªµç³ØµÄµçÁ¿¼ì²â¶Ë
  58          sbit BatteryControl=P1^2;
  59          
  60          unsigned char count=0;//Êı¾İ½ÓÊÕ²¿·ÖµÄ¼ÆÊıÆ÷
  61          
  62          unsigned int lastAddr=0;//ÉÏÒ»´Î½ÓÊÕµ½µÄ±àÂëµÄµØÖ·
  63          
  64          unsigned char time0Count_1=0;//×÷ÎªÈıÖá´«¸ĞÆ÷Á½¸öÂö³åÖ®¼äµÄÊ±¼ä¼ä¸ô¼ÆÊ±
  65          unsigned char time0Count_2=0;//×÷ÎªÈıÖá´«¸ĞÆ÷µÄ¼ÆÊ±
  66          unsigned char time0Count_3=0;//×÷Îª´®¿ÚÃ¿ÃëÖ÷¸¨»úµÄĞÅÏ¢½»»¥Ê±ÖÓ
  67          unsigned char time0Count_4=0;//×÷ÎªÌ§ÆğÂö³åµÄÊ±¼ä¼ä¸ô¼ÆÊ±
  68          unsigned char time0Count_5=0;//×÷Îªµ¹µØÂö³åµÄÊ±¼ä¼ä¸ô¼ÆÊ±
  69          
  70          bit SensorFlag=0; //ÈıÖá´«¸ĞÆ÷µÄµÍµçÆ½±êÖ¾Î»
  71          unsigned char  SensorCount=0; //×÷ÎªÈıÖá´«¸ĞÆ÷Âö³åµÄ¼ÆÊı
  72          
  73          unsigned char TestFlag=0;//1¡¢2¡¢3·Ö±ğÎªÃ¿´Î½ÓÊÕµ½¸½»ú·¢ËÍÀ´Êı¾İºóµÄ¼ÆÊı£¬ÔÚ´®¿ÚµÄ³É¹¦Ö¸ÁîÀï»áÖ´ĞĞ½«È¥¹éÁã
             -µÄ²Ù×÷
  74                          //Èç¹ûÁ¬Ğø3´Î¶¼Ã»ÓĞ¹éÁã£¬ÔòËµÃ÷²»ÔÚ³¡ÁË
  75          unsigned char ModeFlag=1;//Ä£Ê½Ñ¡ÔñÎ»£¬1ÔòÓÃÄ£Ê½1,2ÔòÓÃÄ£Ê½2,3ÔòÎªÄ£Ê½3
  76          
  77          bit alarmFlag=0;//±¨¾¯ÓïÒôµÄ¿ªÆô±êÖ¾
  78          bit alarmFlag2=0;//±¨¾¯ÓïÒô±êÖ¾2
  79          unsigned int alarmCount=0;//±¨¾¯ÓïÒôµÄ´ÎÊı
  80          
  81          bit threeFlag=0;//ÈıÂ·Ñ­»·¿ª¹Ø±êÖ¾
  82          
  83          bit power1Flag=0;
  84          bit power2Flag=0;
  85          bit power3Flag=0;
  86          bit power4Flag=0;
  87          
  88          bit voiceFlag=0;
  89          bit downUpFlag=0;  //µ¹µØºÍÌ§Æğ¼ì²â±êÖ¾
  90          
  91          bit downFlag=0;//µ¹µØµÄ±êÖ¾
  92          bit upFlag=0;//Ì§ÆğµÄ±êÖ¾
  93          bit downFlagSend=0;//µ¹µØ·¢ËÍµÄ±êÖ¾
  94          bit upFlagSend=0;//Ì§Æğ·¢ËÍµÄ±êÖ¾
  95          
  96          //×÷Îª½ÓÊÕºÍ·¢ËÍµÄ»º´æÇø
  97          unsigned char TxRxBuf[28]={0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
             -,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
  98          //Ò»¸öÍ·×Ö½Ú£¬Ò»¸öµØÖ·×Ö½Ú£¬Ò»¸öÃüÁî×Ö½Ú£¬Á½¸ö±àÂëµØÖ·×Ö½Ú£¬Á½¸ö±àÂë
  99          unsigned char myTxRxData[7]={0x00,0x00,0x00,0x00,0x00,0x00,0x00};//´¦ÀíÍêºóµÄÍ¨ĞÅÊı¾İµÄ»º³åÇø
 100          
 101          unsigned int Check=0;//µçÁ¿¼ì²â
 102          //unsigned char Check1=0;//×÷ÎªAD¼ì²âÖµ
 103          
 104          bit receiveFlag=0;//½ÓÊÕµ½Êı¾İ±êÖ¾
 105          bit commuFlag=0;//¿ªÆôÍ¨ĞÅ±êÖ¾
 106          
 107          unsigned char DataBetween=0;//×÷Îª½ÓÊÕÊı¾İµÄÖĞ¼ä±äÁ¿
 108          unsigned char RecData=0;//½ÓÊÕµ½µÄÊı¾İ
 109          unsigned char DataTime=0;//×÷Îª½ÓÊÕµÄÊı¾İµÄÒÆÎ»´ÎÊı¼ÆÊı
 110          bit ComFlag=1;//×öÉÏÉıÑØµÄÒ»¸ö±êÖ¾
 111          //unsigned int newAddr=0;
 112          unsigned char T1highcount=0;       //¶¨Ê±Æ÷T1ÔÚÃ»ÓĞĞÅºÅµ½À´µÄÊ±ºò£¬¶Ô¸ßµçÆ½¼ÆÊı£¬Ò»µ©³¬¹ıÄ³¸öÖµ£¬Ôò½«Datatime
             -Çå0
 113          
C51 COMPILER V9.01   NEWHOST                                                               08/18/2013 12:09:10 PAGE 3   

 114          //¹¦·Å¿ª¹Ø¿ØÖÆ£¬1Îª´ò¿ª¹¦·Å£¬0Îª¹Ø±Õ¹¦·Å
 115          sbit PAshutdown=P1^4;
 116          
 117          //¶¨Òåµç´ÅÌú×ª¶¯Óë·ñ
 118          unsigned char magnetflag=0;
 119          
 120          //¶¨ÒåÒ»¸ö¼ÆÊı£¬À´±íÊ¾ĞÅºÅ½ÓÊÕºó£¬¶à³¤Ê±¼äÊ¹½ÓÊÕ»ú´ò¿ª£¬¼´¿ØÖÆSwitchControlµÄ¸ßµçÆ½Ê±¼ä¡£
 121          //unsigned int SwitchControlcount=0;
 122          
 123          //·¢ËÍ±àÂëĞÅºÅ±êÖ¾Î»
 124          //unsigned char commode2_flag=0; //·¢ËÍ±àÂë2µÄ±êÖ¾Î»
 125          //unsigned char commode3_flag=0; //·¢ËÍ±àÂë3µÄ±êÖ¾Î»
 126          
 127          bit ADCcheck=0;                 //ÖÃ1Ê±£¬Ö´ĞĞÒ»´ÎµçÁ¿×ª»»£¬Ö´ĞĞÍêºó£¬½«ÆäÖÃ0
 128          bit sendcomm1=0;                //ÖÃ1Ê±£¬Ö´ĞĞÒ»´Î·¢ËÍ±àÂë1£¬Ö´ĞĞÍêºó£¬½«ÆäÖÃ0
 129          bit sendcomm3=0;                //ÖÃ1Ê±£¬Ö´ĞĞÒ»´Î·¢ËÍ±àÂë3£¬Ö´ĞĞÍêºó£¬½«ÆäÖÃ0
 130          bit sendcomm4=0;                //ÖÃ1Ê±£¬Ö´ĞĞÒ»´Î·¢ËÍ±àÂë4£¬Ö´ĞĞÍêºó£¬½«ÆäÖÃ0
 131          bit sendcomm5=0;                //ÖÃ1Ê±£¬Ö´ĞĞÒ»´Î·¢ËÍ±àÂë5£¬Ö´ĞĞÍêºó£¬½«ÆäÖÃ0
 132          bit magcon=0;                   //ÖÃ1Ê±£¬Ö´ĞĞÒ»´Îµç´ÅÌúËøÉÏ²Ù×÷£¬Ö´ĞĞÍêºó£¬½«ÆäÖÃ0
 133          bit magcon2=0;                  //ÖÃ1Ê±£¬Ö´ĞĞÒ»´Îµç´ÅÌú´ò¿ª²Ù×÷£¬Ö´ĞĞÍêºó£¬½«ÆäÖÃ0
 134          bit sendspeech1=0;              //ÖÃ1Ê±£¬Ö´ĞĞÒ»´Î±¨ÓïÒô£¨±»Åö¾¯¸æ£©£¬Ö´ĞĞÍêºó£¬½«ÆäÖÃ0
 135          bit sendspeech2=0;              //ÖÃ1Ê±£¬Ö´ĞĞÒ»´Î±¨ÓïÒô£¨¾¯µÑÒô+±¨¾¯£©£¬Ö´ĞĞÍêºó£¬½«ÆäÖÃ0
 136          bit sendspeech3=0;              //ÖÃ1Ê±£¬Ö´ĞĞÒ»´Î±¨ÓïÒô£¨±»Åö¾¯¸æ£©£¬Ö´ĞĞÍêºó£¬½«ÆäÖÃ0
 137          bit sendspeech4=0;              //ÖÃ1Ê±£¬Ö´ĞĞÒ»´Î±¨ÓïÒô£¨¾¯µÑÒô+±¨¾¯£©£¬Ö´ĞĞÍêºó£¬½«ÆäÖÃ0
 138          bit sendspeech5=0;
 139          bit sendspeech6=0;
 140          bit sendspeech7=0;
 141          bit sendspeech8=0;
 142          
 143          bit turnonflag=0;               //µç¶¯³µ¿ªÆô¹Ø±Õ±êÖ¾Î»£¬1±íÊ¾µç¶¯³µ¿ªÆôÁË£¬0±íÊ¾µç¶¯³µ¹Ø±ÕÁË
 144          unsigned char turnon_speech_flag=0;             //¿ª»úÓïÒô±êÖ¾Î»£¬ÓÃÀ´±ä»»ÓïÒô¡£
 145          
 146          //º¯ÊıÉùÃ÷
 147          //void ComMode_1_Data(unsigned int sendAddr);   //·¢ËÍÄ£Ê½1±àÂë
 148          void ComMode_1_Data(void);      //·¢ËÍÄ£Ê½1±àÂë
 149          void ComMode_2_Data(void);//·¢ËÍÄ£Ê½2±àÂë
 150          void ComMode_3_Data(void);//·¢ËÍÄ£Ê½3±àÂë
 151          void ComMode_4_Data(void);//·¢ËÍÌ§Æğ±àÂë
 152          void ComMode_5_Data(void);//·¢ËÍµ¹µØ±àÂë
 153          void ComMode_6_Data(void);//·¢ËÍ³äµçÒÑÂú±àÂë
 154          void verifybattery(void);
 155          
 156          //void codeData(unsigned char *doData,unsigned char len);               //±àÂë ,µçÆ½1±äÎª0011£¬µçÆ½0±äÎª1100
 157          //void transCode(unsigned char *doData,unsigned char len);//½âÂë£¬½«½ÓÊÕµ½µÃÊı¾İ»¹Ô­
 158          
 159          //t=1Ê±£¬ÑÓ³Ù100us×óÓÒ
 160          void Delay3(unsigned int t)
 161          {
 162   1              unsigned int i,j;
 163   1              for(i=0;i<t;i++)                
 164   1              for(j=0;j<19;j++);
 165   1      }
 166          void Delay4(unsigned int t)
 167          {
 168   1              unsigned int i,j;
 169   1              for(i=0;i<t;i++)                
 170   1              for(j=0;j<26;j++);
 171   1      }
 172          
 173          //init signal£¬·¢ËÍ±àÂëĞÅºÅÇ°µÄÆğÊ¼ĞÅºÅ£¬ÓÃÓÚ½«½ÓÊÕ»úµÄ×Ô¶¯ÔöÒæ´ò¿ª
 174          void initsignal()
 175          {
C51 COMPILER V9.01   NEWHOST                                                               08/18/2013 12:09:10 PAGE 4   

 176   1              unsigned char k,k1;
 177   1              unsigned char mystartbuffer=0xaa;
 178   1              for(k1=0;k1<3;k1++)
 179   1              {
 180   2                      for(k=0;k<8;k++)
 181   2                      {
 182   3                              if((mystartbuffer&0x80)==0x80)//Îª1
 183   3                              {
 184   4                                      P10=0;
 185   4                                      Delay3(80);//ÑÓÊ±4.5msÒÔÉÏ£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
 186   4                              }
 187   3                              else//Îª0µÄÇé¿ö
 188   3                              {
 189   4                                      P10=0;
 190   4                                      Delay3(80);//ÑÓÊ±2ms£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
 191   4                              }
 192   3                              P10=1;//³£Ì¬Îª¸ßµçÆ½
 193   3                              mystartbuffer<<=1;
 194   3                              Delay3(150);//ÑÓÊ±Òª´óÓÚ2ms
 195   3                      }
 196   2                      mystartbuffer=0xaa;
 197   2                      Delay3(80);
 198   2              }
 199   1              P10=1;
 200   1      //      Delay3(80);
 201   1      }
 202          
 203          void main()
 204          {
 205   1              SensorControl=1;                  //ÉÏµç¹Ø±Õ´«¸ĞÆ÷
 206   1      
 207   1              noVoice();
 208   1              InitT0();
 209   1              InitT1();
 210   1              
 211   1              PAshutdown=0;           //½«¹¦·Å¹Ø±Õ
 212   1      
 213   1              upSignal=1;
 214   1              downSignal=1;
 215   1              ET0=1;  //¿ªÆô¶¨Ê±Æ÷0ÖĞ¶Ï
 216   1              ET1=1; //¿ªÆô¶¨Ê±Æ÷1ÖĞ¶Ï
 217   1              PT1=1;//¶¨Ê±Æ÷1µÄÖĞ¶ÏÓÅÏÈ¼¶×î¸ß
 218   1              EA=1;
 219   1              P10=1;
 220   1              det_charge=1;
 221   1              det_battery=1;   
 222   1              BatteryControl=0;       //¸½»úÉÏµçµÄÊ±ºòÖÃ0£¬¼´¿ÉÒÔ³äµç£¬µç³ØÔÚÃ»ÓĞ³äÂúµÄÇé¿öÏÂÎªµÍµçÆ½
 223   1              myPwm();        //¿ª·¢Éä»ú
 224   1      
 225   1              ModeControl_1=0; //·¢Éä»úÄ£Ê½¿ØÖÆ¶Ë,¿ª»úÊ±Îª30MÄ£Ê½
 226   1              
 227   1              MagentControl_1=0;//¹Ø±Õ´ÅÌú
 228   1              MagentControl_2=1;
 229   1              Delay(27);
 230   1              MagentControl_1=0;//´ÅÌú³£Ì¬ÎªÕâÖÖÄ£Ê½
 231   1              MagentControl_2=0;
 232   1              magnetflag=0;
 233   1      
 234   1              commuFlag=1; //¿ªÆôÍ¨ĞÅ
 235   1              tran_en=0;   //¹Ø±ÕÎŞÏß·¢Éä»ú
 236   1      
 237   1              downUpFlag=1;
C51 COMPILER V9.01   NEWHOST                                                               08/18/2013 12:09:10 PAGE 5   

 238   1      
 239   1              while(1)
 240   1              {
 241   2                      if((det_battery==1)&&(turnonflag==0))              //¿ª³µ×ª¶¯Ô¿³×Ê±£¬Ö´ĞĞÒ»´ÎµçÁ¿×ª»»
 242   2                      {
 243   3                              Delay(30);
 244   3                              if(det_battery==1)
 245   3                              {
 246   4                                      verifybattery();
 247   4                                      
 248   4                                      if(turnon_speech_flag==0)
 249   4                                      {
 250   5                                              SC_Speech(7);
 251   5                                      }
 252   4                                      else
 253   4                                      {
 254   5                                              SC_Speech(8);
 255   5                                      }
 256   4      
 257   4                                      turnonflag=1;
 258   4                              }
 259   3                      }
 260   2                      else if((det_battery==0)&&(turnonflag==1))
 261   2                      {
 262   3                              Delay(30);
 263   3                              if(det_battery==0)
 264   3                              {
 265   4                                      verifybattery();
 266   4                                      if((Check<0x300))                                                 //Ğ¡ÓÚ38V±¨¾¯£¬Ğ¡ÓÚ5¹«ÀïÁË
 267   4                                      {
 268   5                                              PAshutdown=1;
 269   5                                              SC_Speech(10);  //µÍÓÚ3.6vµçÁ¿³ä×ãÌáÊ¾
 270   5                                              Delay(130);
 271   5                                              PAshutdown=0;
 272   5                                      }
 273   4                                      PAshutdown=1;
 274   4                                      SC_Speech(9);
 275   4                                      Delay(130);
 276   4                                      PAshutdown=0;
 277   4                                      turnonflag=0;
 278   4                              }
 279   3                      }
 280   2                      
 281   2                      if(det_charge==0)
 282   2                      {
 283   3                              Delay(100);
 284   3                              if(det_charge==0)
 285   3                              {
 286   4                                      PAshutdown=1;
 287   4                                      SC_Speech(14);
 288   4                                      Delay(130);
 289   4                                      PAshutdown=0;
 290   4                              }
 291   3                              
 292   3                              if(Check>=0x3a3)
 293   3                              {
 294   4                                      ComMode_6_Data(); //Ïò¸½»ú·¢ËÍ±àÂë6£¬±íÊ¾µçÒÑ³äÂú
 295   4                              }                         
 296   3                      }
 297   2      
 298   2                      if(ADCcheck==1)
 299   2                      {
C51 COMPILER V9.01   NEWHOST                                                               08/18/2013 12:09:10 PAGE 6   

 300   3                              Check=GetADCResult(6);  //µç³ØµçÁ¿¼ì²â
 301   3                              ADCcheck=0;     
 302   3                      }
 303   2                      
 304   2                      if(sendcomm1==1)
 305   2                      {
 306   3                              ComMode_1_Data(); //Ïò¸½»ú·¢ËÍ±àÂë3
 307   3                              sendcomm1=0;
 308   3                      }               
 309   2                      
 310   2                      if(sendcomm3==1)
 311   2                      {
 312   3                              ComMode_3_Data(); //Ïò¸½»ú·¢ËÍ±àÂë3
 313   3                              sendcomm3=0;
 314   3                      }
 315   2      
 316   2                      if(sendcomm4==1)
 317   2                      {
 318   3                              ComMode_4_Data(); //Ïò¸½»ú·¢ËÍ±àÂë3
 319   3                              sendcomm4=0;
 320   3                      }
 321   2      
 322   2                      if(sendcomm5==1)
 323   2                      {
 324   3                              ComMode_5_Data(); //Ïò¸½»ú·¢ËÍ±àÂë3
 325   3                              sendcomm5=0;
 326   3                      }
 327   2      
 328   2                      if(magcon==1)
 329   2                      {
 330   3                              if(magnetflag==1)
 331   3                              {
 332   4                                      MagentControl_1=0;//¹Ø±Õ´ÅÌú
 333   4                                      MagentControl_2=1;
 334   4                                      Delay(27);
 335   4                                      MagentControl_1=0;//´ÅÌú³£Ì¬ÎªÕâÖÖÄ£Ê½
 336   4                                      MagentControl_2=0;
 337   4                                      magnetflag=0;
 338   4                              }
 339   3                              magcon=0;
 340   3                      }
 341   2      
 342   2                      if(magcon2==1)
 343   2                      {
 344   3                              if(magnetflag==0)
 345   3                              {
 346   4                                      MagentControl_1=1;//¿ªÆô´ÅÌú
 347   4                                      MagentControl_2=0;
 348   4                                      Delay(27);
 349   4                                      MagentControl_1=0;//´ÅÌú³£Ì¬ÎªÕâÖÖÄ£Ê½
 350   4                                      MagentControl_2=0;
 351   4                                      magnetflag=1;
 352   4                              }
 353   3                              magcon2=0;
 354   3                      }
 355   2      
 356   2                      if(sendspeech1==1)
 357   2                      {
 358   3                              PAshutdown=1;
 359   3                              SC_Speech(17);  //¹Ø»úÓïÑÔÌáĞÑ
 360   3                              Delay(80);
 361   3                              PAshutdown=0;
C51 COMPILER V9.01   NEWHOST                                                               08/18/2013 12:09:10 PAGE 7   

 362   3                              sendspeech1=0;
 363   3                      }
 364   2      
 365   2                      if(sendspeech2==1)
 366   2                      {
 367   3                              if(upSignal==0)
 368   3                              {
 369   4                                      PAshutdown=1;
 370   4                                      SC_Speech(17);  //¹Ø»úÓïÑÔÌáĞÑ
 371   4                                      Delay(100);
 372   4                                      SC_Speech(18);  //¹Ø»úÓïÑÔÌáĞÑ
 373   4                                      Delay(100);
 374   4                                      SC_Speech(19);  //¹Ø»úÓïÑÔÌáĞÑ
 375   4                                      Delay(100);
 376   4                                      PAshutdown=0;
 377   4                                      ComMode_3_Data(); //Ïò¸½»ú·¢ËÍ±àÂë3
 378   4                              }
 379   3                              else if(downSignal==0)
 380   3                              {
 381   4                                      PAshutdown=1;
 382   4                                      SC_Speech(15);  //¹Ø»úÓïÑÔÌáĞÑ
 383   4                                      Delay(100);
 384   4                                      SC_Speech(16);  //¹Ø»úÓïÑÔÌáĞÑ
 385   4                                      Delay(100);
 386   4                                      PAshutdown=0;
 387   4                                      ComMode_3_Data(); //Ïò¸½»ú·¢ËÍ±àÂë3
 388   4                              }
 389   3                              else
 390   3                              {
 391   4                                      if(alarmFlag==1)
 392   4                                      {
 393   5                                              PAshutdown=1;
 394   5                                              SC_Speech(22);  //¹Ø»úÓïÑÔÌáĞÑ
 395   5                                              Delay(100);
 396   5                                              PAshutdown=0;
 397   5                                      }
 398   4                                      ComMode_3_Data(); //Ïò¸½»ú·¢ËÍ±àÂë3
 399   4                                      if(alarmFlag==1)
 400   4                                      {
 401   5                                              PAshutdown=1;
 402   5                                              SC_Speech(23);  //¹Ø»úÓïÑÔÌáĞÑ          
 403   5                                              Delay(80);
 404   5                                              PAshutdown=0;
 405   5                                      }
 406   4                                      ComMode_3_Data(); //Ïò¸½»ú·¢ËÍ±àÂë3
 407   4                              }
 408   3                              
 409   3      
 410   3                              sendspeech2=0;
 411   3                      }
 412   2      
 413   2                      if(sendspeech3==1)
 414   2                      {
 415   3                              PAshutdown=1;
 416   3                              SC_Speech(17);  //¹Ø»úÓïÑÔÌáĞÑ
 417   3                              Delay(80);
 418   3                              SC_Speech(16);  //¹Ø»úÓïÑÔÌáĞÑ
 419   3                              Delay(80);
 420   3                              PAshutdown=0;
 421   3                              sendspeech3=0;
 422   3                      }
 423   2                      if(sendspeech3==1)
C51 COMPILER V9.01   NEWHOST                                                               08/18/2013 12:09:10 PAGE 8   

 424   2                      {
 425   3                              PAshutdown=1;
 426   3                              SC_Speech(18);  //¹Ø»úÓïÑÔÌáĞÑ
 427   3                              Delay(120);
 428   3                              SC_Speech(19);  //¹Ø»úÓïÑÔÌáĞÑ
 429   3                              Delay(120);
 430   3                              SC_Speech(20);  //¹Ø»úÓïÑÔÌáĞÑ
 431   3                              Delay(120);
 432   3                              PAshutdown=0;
 433   3                              sendspeech3=0;
 434   3                      }
 435   2      
 436   2                      if(sendspeech7==1)
 437   2                      {
 438   3                              PAshutdown=1;
 439   3                              SC_Speech(11);  //¹Ø»úÓïÑÔÌáĞÑ
 440   3                              Delay(150);
 441   3                              PAshutdown=0;
 442   3                              sendspeech7=0;
 443   3                      }
 444   2      
 445   2                      if(sendspeech8==1)
 446   2                      {
 447   3                              PAshutdown=1;
 448   3                              SC_Speech(12);  //¹Ø»úÓïÑÔÌáĞÑ
 449   3                              Delay(150);
 450   3                              SC_Speech(13);
 451   3                              Delay(150);
 452   3                              PAshutdown=0;
 453   3                              sendspeech8=0;
 454   3                      }
 455   2      
 456   2              }
 457   1      }
 458          
 459          void timeT1() interrupt 3 //¶¨Ê±Æ÷1ÖĞ¶Ï½ÓÊÕÊı¾İ
 460          {
 461   1      
 462   1              TH1=timer1H;//ÖØ×°ÔØ
 463   1              TL1=timer1L;
 464   1              
 465   1              if(P11==0)//Õı³£Çé¿öÎª¸ßµçÆ½,ÓĞµÍµçÆ½ËµÃ÷ÓĞĞÅºÅ
 466   1              {
 467   2                      DataBetween++;
 468   2                      ComFlag=0;
 469   2                      if(DataBetween==150)//µÍµçÆ½³ÖĞøµÄ×î´óÊ±¼ä      
 470   2                      {
 471   3                              DataBetween=0;
 472   3                      }
 473   2              }
 474   1              else//Îª¸ßµçÆ½ÁË
 475   1              {
 476   2                      if(ComFlag==0)//ËµÃ÷ÓĞÒ»¸öµÍµçÆ½
 477   2                      {
 478   3                              ComFlag=1;
 479   3      
 480   3                              if((DataBetween>60)&&(DataBetween<=100))        //µÍµçÆ½³ÖĞøµÄÊ±¼äĞ¡ÓÚ10ms£¬ÔòÎª0
 481   3                              {
 482   4                                      RecData<<=1;
 483   4                                      RecData &= 0xfe;
 484   4                                      DataTime++;
 485   4                                      T1highcount=0;
C51 COMPILER V9.01   NEWHOST                                                               08/18/2013 12:09:10 PAGE 9   

 486   4                              }
 487   3                              else if((DataBetween>100))//µÍµçÆ½³ÖĞøµÄÊ±¼ä´óÓÚ4.5ms£¬ÔòÎª1
 488   3                              {
 489   4                                      RecData<<=1;
 490   4                                      RecData |= 0x01;
 491   4                                      DataTime++;
 492   4                                      T1highcount=0;
 493   4                              }
 494   3                              else
 495   3                              {
 496   4                                      T1highcount++;  
 497   4                              }
 498   3      
 499   3                              DataBetween=0;
 500   3                      }
 501   2      
 502   2                      else
 503   2                      {
 504   3                              T1highcount++;
 505   3                              if(T1highcount>=120)
 506   3                              {
 507   4                                      DataTime=0;
 508   4                                      ComFlag=1;
 509   4                                      count=0;
 510   4                              }               
 511   3                      }
 512   2              }
 513   1      
 514   1              if(DataTime==8)//ËµÃ÷Ò»¸ö×Ö½ÚµÄÊı¾İÒÑ¾­½ÓÊÜÍêÈ«
 515   1              {
 516   2                      DataTime=0;
 517   2                      myTxRxData[count]=RecData;
 518   2                      if(count==0&&myTxRxData[0]==CmdHead)
 519   2                      {
 520   3                              count=1;
 521   3                      }
 522   2                      else if(count==1&&myTxRxData[1]==MyAddress)
 523   2                      {
 524   3                              count=2;
 525   3      
 526   3                      }
 527   2                      else if(count>=2&&count<=5)
 528   2                      {
 529   3                              count++;
 530   3                      }
 531   2                      else if(count==6)
 532   2                      {
 533   3                          receiveFlag=1;
 534   3                              count=0;
 535   3                      }
 536   2                      else 
 537   2                      {
 538   3                              count=0;
 539   3                      }
 540   2              }
 541   1      
 542   1              if(receiveFlag==1)
 543   1              {
 544   2                      receiveFlag=0;
 545   2                      switch(myTxRxData[2])           //¶ÔÊı¾İÖ¡ÀïµÄÃüÁî½øĞĞ´¦Àí
 546   2                      {
 547   3                              case ComMode_1:                 //¸½»ú·¢ËÍ¹ıÀ´µÄÖ»ÓÃÄ£Ê½1£¬ËµÃ÷ÏÖÔÚÊÇÕı³£µÄ£¬Êı¾İ²¿·ÖÎªÊı×éµÄµÚÒ»ºÍµÚ¶ş¸ö×Ö½Ú£¬ÎªÃÜÂ
C51 COMPILER V9.01   NEWHOST                                                               08/18/2013 12:09:10 PAGE 10  

             -ë±íÄÚµÄÕâ¸ö±àÂëµÄ¿ªÊ¼×Ö½ÚµÄÄÇ¸öµØÖ·£¬È»ºóÌî³äÊı¾İÖ¡£¬°ÑÃÜÂë±íµÄÊı¾İ·¢ËÍ³öÈ¥
 548   3                              {
 549   4                                      sendcomm1=1;
 550   4                                      sendspeech7=1;          //±àÂë1ºó±¨Ò»¾äÓïÒô
 551   4      
 552   4                                      alarmFlag=0;            //¹Ø±¨¾¯±êÖ¾Î»
 553   4                                      alarmCount=0;           //±¨¾¯¼ÆÊı´ÎÊıÇåÁã
 554   4                                      SensorControl=0;        //ÈıÖá´«¸ĞÆ÷
 555   4                                      downUpFlag=0;           //¹Øµ¹µØ¡¢Ì§Æğ¼ì²â
 556   4                                      downFlag=0;
 557   4                                      upFlag=0;
 558   4                                      SensorCount=0;
 559   4                                      time0Count_2=0;                 
 560   4                                      magcon2=1;                      //´ò¿ªµç´ÅÌú
 561   4      
 562   4                                      TestFlag=0;     
 563   4                                      if(ModeFlag==3||ModeFlag==2)
 564   4                                      {
 565   5                                              ModeFlag=1;
 566   5                                      }
 567   4                              }
 568   3                              break;
 569   3                      }
 570   2              }
 571   1      }
 572          
 573          void time0() interrupt 1        //×÷ÎªÕû¸öÏµÍ³×Ô¼ºµÄÊ±ÖÓ
 574          {
 575   1              TH0=timer0H;//ÖØ×°ÔØ
 576   1              TL0=timer0L;
 577   1              time0Count_3++;
 578   1      
 579   1              if(time0Count_3>=60)//´®¿ÚÃ¿3s½ÓÊÜÒ»´ÎµÄÊı¾İµÄÊ±¼ä±êÖ¾
 580   1              {
 581   2                      if(commuFlag==1)//ËµÃ÷¿ªÆôÁËÍ¨ĞÅ
 582   2                      {
 583   3                              TestFlag++;
 584   3      
 585   3                              if(TestFlag>=3&&ModeFlag==1)//ËµÃ÷Ã»ÓĞ½ÓÊÕµ½Êı¾İÒÑ¾­ÓĞ3´ÎÁË£¬¸½»úÒÑ¾­³öÁË3M£¬ÏÖÔÚ¾ÍÒª¼Ó´ó¹¦ÂÊ£¬ÇĞ»»µ½Ä£
             -Ê½2,30MÔÙ¿´ÄÜ²»ÄÜ½ÓÊÕµ½Êı¾İ
 586   3                              {
 587   4                                      TestFlag=5;
 588   4                                      if(ModeFlag==1)
 589   4                                      {
 590   5                                              magcon=1;                       //µç´ÅÌúËøÉÏ
 591   5                                              sendspeech8=1;          //±¨¸½»úÀë¿ªÓïÒô
 592   5      
 593   5                                              SensorControl=1;        //¿ªÆôÈıÖá´«¸ĞÆ÷
 594   5                                              downUpFlag=1;           //¿ªÆôµ¹µØ¡¢Ì§Æğ±êÖ¾
 595   5                                              ModeFlag=2;
 596   5      
 597   5                                              SensorCount=0;
 598   5                                              time0Count_2=0;
 599   5                                      }       
 600   4                              }
 601   3                      }
 602   2                      time0Count_3=0;
 603   2                      
 604   2                      ADCcheck=1;             
 605   2                      
 606   2                      if(downFlag==1)  //µ¹µØºó×öÏàÓ¦µÄ¶¯×÷
 607   2                      {
C51 COMPILER V9.01   NEWHOST                                                               08/18/2013 12:09:10 PAGE 11  

 608   3                              sendcomm5=1;
 609   3                      }
 610   2                      if(upFlag==1)//Ì§Æğºó×öÏàÓ¦¶¯×÷
 611   2                      {
 612   3                              sendcomm4=1;
 613   3                      }
 614   2              }
 615   1      
 616   1              if(SensorControl==1)//¼ì²âÈıÖá´«¸ĞÆ÷ÊÇ·ñ´ò¿ª
 617   1              {
 618   2                      if(ReceWave==0)//ËµÃ÷ÓĞ´¥·¢Çé¿ö£¬¿ªÊ¼¼ÆÊ±
 619   2                      {
 620   3                              time0Count_2++;
 621   3                              if(time0Count_2>=25)//ËµÃ÷ÒÑ¾­´óÓÚ0.5S
 622   3                              {
 623   4                                      time0Count_2=0;//¼ÆÊ±ÆÚÇåÁã
 624   4                                      SensorCount++;//ÈıÖá´«¸ĞÆ÷Âö³å¼ÆÊı¼Ó1
 625   4                                      alarmFlag2=1;
 626   4                              }
 627   3                              
 628   3                              if(time0Count_1>=200)
 629   3                              {
 630   4                                      time0Count_1=0;         //¼ì²âµ½µÍµçÆ½ºó£¬È»ºóÅĞ¶Ï¸ßµçÆ½ÊÇ·ñ´óÓÚ200£¬Èç¹ûÊÇ£¬Ôò½«ÆäÇå0£¬Èç¹û²»ÊÇ£¬Ôò²»Ó°Ïì¡£    
 631   4                              }               
 632   3                      }
 633   2                      else if(ReceWave==1&&SensorCount!=0)//ËµÃ÷ÒÑ¾­ÓĞÒ»¸öÓĞÓÃµÄÂö³å
 634   2                      {
 635   3                              time0Count_1++;
 636   3                              if(time0Count_1>=100)//´óÓÚ10S
 637   3                              {
 638   4                                      SensorCount=0;
 639   4                                      time0Count_2=0;
 640   4                              }
 641   3                      }
 642   2              }
 643   1      
 644   1              if(ModeFlag==2&&SensorCount>=1)//ÈıÖá´«¸ĞÆ÷Âö³åµÄÏàÓ¦±¨¾¯
 645   1              {
 646   2                      if(SensorCount==1&&alarmFlag2==1)//ÈıÖá´«¸ĞÆ÷Ò»´Î´¥·¢,alarmFlag2¿ØÖÆ·¢Éù1´Î
 647   2                      {                                       
 648   3                              if((upSignal!=0)&&(downSignal!=0))
 649   3                              {
 650   4                                      sendspeech1=1;
 651   4                                      alarmFlag2=0;
 652   4                              }
 653   3                      }
 654   2      
 655   2                      if((SensorCount==2)&&(alarmFlag2==1))
 656   2                      {
 657   3                              if((upSignal!=0)&&(downSignal!=0))
 658   3                              {
 659   4                                      sendspeech3=1;
 660   4                                      alarmFlag2=0;
 661   4                              }                       
 662   3                      }
 663   2      
 664   2                      if((SensorCount==3)&&(alarmFlag2==1))
 665   2                      {
 666   3                              if((upSignal!=0)&&(downSignal!=0))
 667   3                              {
 668   4                                      sendspeech4=1;
 669   4                                      alarmFlag2=0;
C51 COMPILER V9.01   NEWHOST                                                               08/18/2013 12:09:10 PAGE 12  

 670   4                              }                       
 671   3                      }
 672   2      
 673   2                      if(SensorCount>=4)//ÈıÖá´«¸ĞÆ÷Ò»´Î´¥·¢
 674   2                      {
 675   3                              ModeFlag=3;//ÈıÖá´«¸ĞÆ÷ÒÑ¾­ÓĞ2´Î´¥·¢ÁË£¬Òª¸Ä±ä·¢ÉäÄ£Ê½ÁË
 676   3                              alarmFlag=1;//ÖÃÓïÒô±¨¾¯Î»
 677   3                              alarmFlag2=0;
 678   3                              downFlag=0;
 679   3                              upFlag=0;
 680   3                              SensorCount=0; //Âö³å¼ÆÊıÇåÁã
 681   3                      }
 682   2              }
 683   1      
 684   1              if(ModeFlag==3)
 685   1              {
 686   2                      sendspeech2=1;
 687   2                      time0Count_4=0;                 //½«µ¹µØºÍÌ§ÆğµÄ´«¸ĞÆ÷¼ÆÊıÖÃ0£¬Ïàµ±ÓÚÒ»Ö±ÆÁ±Î
 688   2                      time0Count_5=0;
 689   2      
 690   2                      alarmCount++;
 691   2                      if(alarmCount>=1000) //µ÷½ÚÓïÒôµÄ¶ÎÊı
 692   2                      {
 693   3                              alarmCount=0;//Çå±¨¾¯¼ÆÊıÆ÷
 694   3                              alarmFlag=0;//Çå±¨¾¯±êÖ¾
 695   3                      }
 696   2              }
 697   1      
 698   1      //      //if()//¼ì²âµ¹µØºÍÌ§Æğ¼ì²âµÄ´úÂë
 699   1              if(downUpFlag==1)//¿ªÆôÁËÌ§Æğµ¹µØ¼ì²â
 700   1              {
 701   2                      if(upSignal==0)//ËµÃ÷ÓĞÌ§ÆğĞÅºÅ²¢ÇÒÊÇµÚÒ»´Î£¬¿ªÊ¼¼ÆÊ±
 702   2                      {
 703   3                              time0Count_4++;
 704   3                              if(time0Count_4>=200)//ËµÃ÷ÒÑ¾­´óÓÚ0.5S
 705   3                              {
 706   4                                      upFlag=1;//ÖÃÌ§Æğ±êÖ¾
 707   4                                      downFlag=0;
 708   4                                      alarmFlag=0;
 709   4                              }               
 710   3                      }
 711   2      
 712   2                      if(downSignal==0)//ËµÃ÷ÓĞÌ§ÆğĞÅºÅ£¬¿ªÊ¼¼ÆÊ±
 713   2                      {
 714   3                              time0Count_5++;
 715   3                              if(time0Count_5>=200)//ËµÃ÷ÒÑ¾­´óÓÚ0.5S
 716   3                              {
 717   4                                      time0Count_5 =0;//¼ÆÊ±ÆÚÇåÁã
 718   4                                      downFlag=1;//ÖÃÌ§Æğ±êÖ¾
 719   4                                      upFlag=0;
 720   4                                      alarmFlag=0;
 721   4                              }               
 722   3                      }
 723   2              }
 724   1      }
 725          
 726          
 727          void ComMode_1_Data()//·¢ËÍ±ßÂë1
 728          {
 729   1              unsigned char i,n;
 730   1              ModeControl_1=0;//30M·¢Éä¹¦ÂÊ                           
 731   1              tran_en=1;
C51 COMPILER V9.01   NEWHOST                                                               08/18/2013 12:09:10 PAGE 13  

 732   1              myTxRxData[0]=CmdHead;
 733   1              myTxRxData[1]=MyAddress;
 734   1              myTxRxData[2]=ComMode_1;
 735   1              myTxRxData[3]=0x00;
 736   1              myTxRxData[4]=0x00;
 737   1              myTxRxData[5]=0x00;
 738   1              myTxRxData[6]=0x00;
 739   1      
 740   1              initsignal();
 741   1      
 742   1              for(i=0;i<7;i++)
 743   1              {
 744   2                      for(n=0;n<8;n++)
 745   2                      {
 746   3                              if((myTxRxData[i]&0x80)==0x80)//Îª1
 747   3                              {
 748   4                                      P10=0;
 749   4                                      Delay4(120);//ÑÓÊ±4.5msÒÔÉÏ£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
 750   4                              }
 751   3                              else//Îª0µÄÇé¿ö
 752   3                              {
 753   4                                      P10=0;
 754   4                                      Delay4(80);//ÑÓÊ±2ms£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
 755   4                              }
 756   3                              P10=1;//³£Ì¬Îª¸ßµçÆ½
 757   3                              myTxRxData[i]<<=1;
 758   3                              Delay4(50);//ÑÓÊ±Òª´óÓÚ2ms
 759   3                      }
 760   2              }
 761   1              tran_en=0;
 762   1      }
 763          
 764          void ComMode_2_Data()//·¢ËÍ±ßÂë2
 765          {
 766   1      //      unsigned int j;
 767   1      
 768   1              unsigned char i,n;
 769   1              ModeControl_1=0;//30M·¢Éä¹¦ÂÊ
 770   1              tran_en=1;
 771   1              myTxRxData[0]=CmdHead;
 772   1              myTxRxData[1]=MyAddress;
 773   1              myTxRxData[2]=ComMode_2;
 774   1              myTxRxData[3]=0x00;
 775   1              myTxRxData[4]=0x00;
 776   1              myTxRxData[5]=0x00;
 777   1              myTxRxData[6]=0x00;
 778   1      
 779   1              initsignal();
 780   1      
 781   1              for(i=0;i<7;i++)
 782   1              {
 783   2                      for(n=0;n<8;n++)
 784   2                      {
 785   3                              if((myTxRxData[i]&0x80)==0x80)//Îª1
 786   3                              {
 787   4                                      P10=0;
 788   4                                      Delay3(120);//ÑÓÊ±4.5msÒÔÉÏ£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
 789   4                              }
 790   3                              else//Îª0µÄÇé¿ö
 791   3                              {
 792   4                                      P10=0;
 793   4                                      Delay3(80);//ÑÓÊ±2ms£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
C51 COMPILER V9.01   NEWHOST                                                               08/18/2013 12:09:10 PAGE 14  

 794   4                              }
 795   3                              P10=1;//³£Ì¬Îª¸ßµçÆ½
 796   3                              myTxRxData[i]<<=1;
 797   3                              Delay3(50);//ÑÓÊ±Òª´óÓÚ2ms
 798   3                      }
 799   2              }
 800   1              tran_en=0;
 801   1      }
 802          
 803          void ComMode_3_Data()//·¢ËÍ±ßÂë3
 804          {
 805   1      //      unsigned int j;
 806   1              unsigned char i,n;
 807   1              ModeControl_1=1;//ÇĞ»»Îª300M·¢Éä
 808   1              tran_en=1;
 809   1              myTxRxData[0]=CmdHead;
 810   1              myTxRxData[1]=MyAddress;
 811   1              myTxRxData[2]=ComMode_3;
 812   1              myTxRxData[3]=0x00;
 813   1              myTxRxData[4]=0x00;
 814   1              myTxRxData[5]=0x00;
 815   1              myTxRxData[6]=0x00;
 816   1      
 817   1              initsignal();
 818   1      
 819   1              for(i=0;i<7;i++)
 820   1              {
 821   2                      for(n=0;n<8;n++)
 822   2                      {
 823   3                              if((myTxRxData[i]&0x80)==0x80)//Îª1
 824   3                              {
 825   4                                      P10=0;
 826   4                                      Delay3(120);//ÑÓÊ±4.5msÒÔÉÏ£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
 827   4                              }
 828   3                              else//Îª0µÄÇé¿ö
 829   3                              {
 830   4                                      P10=0;
 831   4                                      Delay3(80);//ÑÓÊ±2ms£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
 832   4                              }
 833   3                              P10=1;//³£Ì¬Îª¸ßµçÆ½
 834   3                              myTxRxData[i]<<=1;
 835   3                              Delay3(50);//ÑÓÊ±Òª´óÓÚ2ms
 836   3                      }
 837   2              }
 838   1              tran_en=0;
 839   1      }
 840          
 841          void ComMode_4_Data()//·¢ËÍÌ§Æğ±àÂë
 842          {
 843   1              unsigned char i,n;
 844   1              ModeControl_1=0;//ÇĞ»»Îª300M·¢Éä
 845   1              tran_en=1;
 846   1              myTxRxData[0]=CmdHead;
 847   1              myTxRxData[1]=MyAddress;
 848   1              myTxRxData[2]=ComMode_4;
 849   1              myTxRxData[3]=0x00;
 850   1              myTxRxData[4]=0x00;
 851   1              myTxRxData[5]=0x00;
 852   1              myTxRxData[6]=0x00;
 853   1      
 854   1              initsignal();
 855   1      
C51 COMPILER V9.01   NEWHOST                                                               08/18/2013 12:09:10 PAGE 15  

 856   1              for(i=0;i<7;i++)
 857   1              {
 858   2                      for(n=0;n<8;n++)
 859   2                      {
 860   3                              if((myTxRxData[i]&0x80)==0x80)//Îª1
 861   3                              {
 862   4                                      P10=0;
 863   4                                      Delay3(120);//ÑÓÊ±4.5msÒÔÉÏ£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
 864   4                              }
 865   3                              else//Îª0µÄÇé¿ö
 866   3                              {
 867   4                                      P10=0;
 868   4                                      Delay3(80);//ÑÓÊ±2ms£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
 869   4                              }
 870   3                              P10=1;//³£Ì¬Îª¸ßµçÆ½
 871   3                              myTxRxData[i]<<=1;
 872   3                              Delay3(50);//ÑÓÊ±Òª´óÓÚ2ms
 873   3                      }
 874   2              }
 875   1              tran_en=0;
 876   1      }
 877          
 878          void ComMode_5_Data()//·¢ËÍµ¹µØ±àÂë
 879          {
 880   1              unsigned char i,n;
 881   1              ModeControl_1=0;//ÇĞ»»Îª300M·¢Éä
 882   1              tran_en=1;      //´ò¿ªÎŞÏß·¢Éä»ú
 883   1              myTxRxData[0]=CmdHead;
 884   1              myTxRxData[1]=MyAddress;
 885   1              myTxRxData[2]=ComMode_5;
 886   1              myTxRxData[3]=0x00;
 887   1              myTxRxData[4]=0x00;
 888   1              myTxRxData[5]=0x00;
 889   1              myTxRxData[6]=0x00;
 890   1      
 891   1              initsignal();
 892   1      
 893   1              for(i=0;i<7;i++)
 894   1              {
 895   2                      for(n=0;n<8;n++)
 896   2                      {
 897   3                              if((myTxRxData[i]&0x80)==0x80)//Îª1
 898   3                              {
 899   4                                      P10=0;
 900   4                                      Delay3(120);//ÑÓÊ±4.5msÒÔÉÏ£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
 901   4                              }
 902   3                              else//Îª0µÄÇé¿ö
 903   3                              {
 904   4                                      P10=0;
 905   4                                      Delay3(80);//ÑÓÊ±2ms£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
 906   4                              }
 907   3                              P10=1;//³£Ì¬Îª¸ßµçÆ½
 908   3                              myTxRxData[i]<<=1;
 909   3                              Delay3(50);//ÑÓÊ±Òª´óÓÚ2ms
 910   3                      }
 911   2              }
 912   1              tran_en=0;
 913   1      }
 914          
 915          void ComMode_6_Data()//·¢ËÍµ¹µØ±àÂë
 916          {
 917   1              unsigned char i,n;
C51 COMPILER V9.01   NEWHOST                                                               08/18/2013 12:09:10 PAGE 16  

 918   1              ModeControl_1=0;//ÇĞ»»Îª300M·¢Éä
 919   1              tran_en=1;      //´ò¿ªÎŞÏß·¢Éä»ú
 920   1              myTxRxData[0]=CmdHead;
 921   1              myTxRxData[1]=MyAddress;
 922   1              myTxRxData[2]=ComMode_6;
 923   1              myTxRxData[3]=0x00;
 924   1              myTxRxData[4]=0x00;
 925   1              myTxRxData[5]=0x00;
 926   1              myTxRxData[6]=0x00;
 927   1      
 928   1              initsignal();
 929   1      
 930   1              for(i=0;i<7;i++)
 931   1              {
 932   2                      for(n=0;n<8;n++)
 933   2                      {
 934   3                              if((myTxRxData[i]&0x80)==0x80)//Îª1
 935   3                              {
 936   4                                      P10=0;
 937   4                                      Delay3(120);//ÑÓÊ±4.5msÒÔÉÏ£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
 938   4                              }
 939   3                              else//Îª0µÄÇé¿ö
 940   3                              {
 941   4                                      P10=0;
 942   4                                      Delay3(80);//ÑÓÊ±2ms£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
 943   4                              }
 944   3                              P10=1;//³£Ì¬Îª¸ßµçÆ½
 945   3                              myTxRxData[i]<<=1;
 946   3                              Delay3(50);//ÑÓÊ±Òª´óÓÚ2ms
 947   3                      }
 948   2              }
 949   1              tran_en=0;
 950   1      }
 951          
 952          void verifybattery()
 953          {                                                                         
 954   1              if((Check>=0x3a3))//ÉèÖÃ±È½ÏµçÑ¹£¬´Ë´¦ÒÔ4.96VÎª»ù×¼£¬´óÓÚ47.4V£¨4.5V£©
 955   1              {
 956   2                      PAshutdown=1;
 957   2                      SC_Speech(6);   //4VµçÁ¿³ä×ãÌáÊ¾
 958   2                      Delay(130);
 959   2                      PAshutdown=0;
 960   2              }
 961   1          else if((Check<0x3a0)&&(Check>=0x37c))              //Ğ¡ÓÚ47.4£¬´óÓÚ45£¨4.31V£©
 962   1              {
 963   2                      PAshutdown=1;
 964   2                      SC_Speech(5);  //3.8VµçÁ¿³ä×ãÌáÊ¾
 965   2                      Delay(130);
 966   2                      PAshutdown=0;
 967   2              }
 968   1              else if((Check<0x378)&&(Check>=0x359))           //Ğ¡ÓÚ45£¬´óÓÚ43£¨4.14V£©
 969   1              {
 970   2                      PAshutdown=1;
 971   2                      SC_Speech(4);  //3.6VµçÁ¿³ä×ãÌáÊ¾
 972   2                      Delay(130);
 973   2                      PAshutdown=0;
 974   2              }
 975   1              else if((Check<0x355)&&(Check>=0x327))           //Ğ¡ÓÚ43£¬´óÓÚ40£¨3.9V£©
 976   1              {
 977   2                      PAshutdown=1;
 978   2                      SC_Speech(3);  //µÍÓÚ3.6vµçÁ¿³ä×ãÌáÊ¾
 979   2                      Delay(130);
C51 COMPILER V9.01   NEWHOST                                                               08/18/2013 12:09:10 PAGE 17  

 980   2                      PAshutdown=0;
 981   2              }
 982   1              else if((Check<0x323)&&(Check>=0x304))            //Ğ¡ÓÚ40£¬´óÓÚ38£¨3.73V£©
 983   1              {
 984   2                      PAshutdown=1;
 985   2                      SC_Speech(2);  //µÍÓÚ3.6vµçÁ¿³ä×ãÌáÊ¾
 986   2                      Delay(130);
 987   2                      PAshutdown=0;
 988   2              }
 989   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   2113    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     56       8
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =     33    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
